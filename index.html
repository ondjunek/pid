<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Metro: Krizová situace</title>
    <style>
        /* 1. NAČTENÍ VLASTNÍHO FONTU */
        @font-face {
            font-family: 'NeueHaas';
            src: url('NeueHaasDisplayBold.ttf'); 
        }

        body {
            background-color: #000;
            color: white;
            font-family: 'NeueHaas', 'Arial', sans-serif; 
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #000;
            border: none;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }

        /* TEXTY - ČISTÉ, BÍLÉ, STATICKÉ */
        h1, h2, #countdown {
            background: none;
            padding: 10px 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: none;
            display: none;
            border: none;
            color: #ffffff; /* Vše bílé */
        }

        h1 { 
            font-size: 50px; 
            font-weight: 700; 
        }
        
        h2 { 
            font-size: 35px; 
            margin-bottom: 20px; 
            font-weight: 700; 
            /* ZDE BYLO BLIKÁNÍ - ODSTRANĚNO */
        }
        
        #countdown {
            font-size: 120px;
            margin-top: 20px;
            font-weight: 900;
            line-height: 1;
        }

        /* LOAD BAR - BÍLÝ */
        #bar-frame {
            width: 50%;
            height: 40px;
            border: 4px solid white; /* Rámeček bílý */
            background: rgba(0,0,0,0.3); /* Pozadí lehce tmavé, aby byla vidět bílá výplň */
            display: none;
            position: relative;
        }

        #bar-fill {
            width: 0%;
            height: 100%;
            background-color: #ffffff; /* VÝPLŇ JE TEĎ ČISTĚ BÍLÁ */
            transition: width 0.1s linear;
        }

    </style>
</head>
<body>

    <div id="game-container">
        <video id="player" muted playsinline></video>
        
        <div id="ui-layer">
            <h1 id="main-text">STISKNI MEZERNÍK PRO START</h1>
            <div id="countdown">10</div>
            
            <div id="mash-ui" style="display:none; width: 100%; display: flex; flex-direction: column; align-items: center;">
                <h2 id="mash-text">TLAČÍTKO ZASEKLÉ! MAČKEJ!!</h2>
                <div id="bar-frame"><div id="bar-fill"></div></div>
            </div>
        </div>
    </div>

    <p style="position: absolute; bottom: 10px; right: 20px; font-size: 14px; color: rgba(255,255,255,0.3);">OVLÁDÁNÍ: MEZERNÍK</p>

    <script>
        // ==========================================
        // ⚙️ NASTAVENÍ VIDEÍ
        // ==========================================
        const V_01_INTRO    = 'video_01.mp4';
        const V_02_FAIL     = 'video_02.mp4';
        const V_03_CLICK    = 'video_03.mp4';
        const V_04_A_RESCUE = 'video_04_A.mp4';
        const V_04_B_TRAGEDY= 'video_04_B.mp4';

        const CAS_NA_REAKCI = 10000;
        const CAS_NA_MASHING = 10000;
        const MASH_DIFFICULTY = 25;
        const BAR_DECAY = 0.3;

        // ==========================================
        
        const video = document.getElementById('player');
        const mainText = document.getElementById('main-text');
        const countdownEl = document.getElementById('countdown');
        const mashUI = document.getElementById('mash-ui');
        const barFill = document.getElementById('bar-fill');
        const mashText = document.getElementById('mash-text');

        let stav = 'START';
        let timerSmrti;
        let odpocetInterval;
        let barValue = 0;
        let gameLoop;

        function play(src, loop = false) {
            video.src = src;
            video.loop = loop;
            video.currentTime = 0;
            video.play().catch(e => console.log("Autoplay blocked"));
        }

        function startHry() {
            stav = 'START';
            mainText.style.display = 'block';
            mainText.innerText = "STISKNI MEZERNÍK PRO START";
            mainText.style.color = '#ffffff';
            mashUI.style.display = 'none';
            mashText.style.display = 'none';
            countdownEl.style.display = 'none';
            document.getElementById('bar-frame').style.display = 'none';
        }

        function spustitIntro() {
            stav = 'INTRO';
            mainText.style.display = 'none';
            play(V_01_INTRO, false);

            video.onended = () => {
                vyzvaKZastaveni();
            };
        }

        function vyzvaKZastaveni() {
            stav = 'WAIT';
            
            mainText.style.display = 'block';
            mainText.innerText = "ZMÁČKNI NOUZOVÉ TLAČÍTKO PRO ZASTAVENÍ SOUPRAVY!";
            mainText.style.color = '#ffffff';
            
            countdownEl.style.display = 'block';
            let zbyvajiciCas = CAS_NA_REAKCI / 1000;
            countdownEl.innerText = zbyvajiciCas;

            odpocetInterval = setInterval(() => {
                zbyvajiciCas--;
                countdownEl.innerText = zbyvajiciCas;
                if (zbyvajiciCas <= 0) clearInterval(odpocetInterval);
            }, 1000);

            timerSmrti = setTimeout(() => {
                prohra("nestihl");
            }, CAS_NA_REAKCI);
        }

        function glitchFaze() {
            stav = 'GLITCH';
            clearTimeout(timerSmrti);
            clearInterval(odpocetInterval);
            
            mainText.style.display = 'none';
            countdownEl.style.display = 'none';
            
            play(V_02_FAIL, false);

            video.onended = () => {
                startMashing();
            };
        }

        function startMashing() {
            stav = 'MASHING';
            barValue = 0;
            
            mashUI.style.display = 'flex';
            mashText.style.display = 'block';
            document.getElementById('bar-frame').style.display = 'block';
            
            play(V_03_CLICK, false); 

            timerSmrti = setTimeout(() => {
                prohra("mashing_fail");
            }, CAS_NA_MASHING);

            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(logicLoop, 50);
        }

        function logicLoop() {
            if (stav !== 'MASHING') return;
            if (barValue > 0) barValue -= BAR_DECAY;
            if (barValue < 0) barValue = 0;
            barFill.style.width = Math.min(barValue, 100) + '%';
        }

        function playerMash() {
            barValue += (100 / MASH_DIFFICULTY); 
            video.currentTime = 0;
            video.play();
            if (barValue >= 100) {
                vyhra();
            }
        }

        function vyhra() {
            stav = 'END';
            clearTimeout(timerSmrti);
            clearInterval(gameLoop);
            mashUI.style.display = 'none'; 
            
            play(V_04_A_RESCUE, false);

            video.onended = () => {
                mainText.style.display = 'block';
                mainText.style.color = '#ffffff';
                mainText.innerHTML = "SUPER VÝHRA!<br>ZACHRÁNIL JSI HO!";
                setTimeout(startHry, 8000);
            };
        }

        function prohra(duvod) {
            if (stav === 'END') return;
            stav = 'END';
            clearTimeout(timerSmrti);
            clearInterval(gameLoop);
            clearInterval(odpocetInterval);
            
            mainText.style.display = 'none';
            countdownEl.style.display = 'none';
            mashUI.style.display = 'none';

            play(V_04_B_TRAGEDY, false);

            video.onended = () => {
                mainText.style.display = 'block';
                mainText.style.color = '#ffffff';
                mainText.innerText = "KONEC... SOUPRAVA NEZASTAVILA.";
                setTimeout(startHry, 8000);
            };
        }

        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                if (stav === 'START') spustitIntro();
                else if (stav === 'WAIT') glitchFaze();
                else if (stav === 'MASHING') playerMash();
            }
        });

        startHry();

    </script>
</body>
</html>