<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Metro Nouzové Tlačítko</title>
    <style>
        /* =========================================
           1. FONTY
           ========================================= */
        @font-face {
            font-family: 'NeueHaasBold';
            src: url('NeueHaasDisplayBold.ttf'); 
        }

        @font-face {
            font-family: 'NeueHaasMedium';
            src: url('NeueHaasDisplayMedium.ttf'); 
        }

        /* =========================================
           2. ZÁKLADNÍ NASTAVENÍ
           ========================================= */
        body {
            background-color: #000;
            color: white;
            font-family: 'NeueHaasBold', sans-serif;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: #000;
            border: none;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        #ui-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: block; 
            pointer-events: none;
            z-index: 10;
        }

        /* =========================================
           3. ROZLOŽENÍ UI PRVKŮ
           ========================================= */

        /* A) START SCREEN */
        #start-container {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            transform: translateY(-50%);
            text-align: center;
            z-index: 20;
            display: flex;
            justify-content: center;
        }

        /* B) GAME TEXTY */
        .text-anchor-top {
            position: absolute;
            top: 15%; 
            left: 0;
            width: 100%;
            display: none; 
            flex-direction: column;
            align-items: center;
            z-index: 20;
        }

        /* C) MASHING UI */
        #mash-ui {
            position: absolute;
            top: 15%; 
            left: 0;
            width: 100%;
            display: none; 
            flex-direction: column;
            align-items: center;
            z-index: 25; 
        }

        /* D) ODPOČET */
        #countdown {
            font-family: 'NeueHaasBold', sans-serif;
            font-size: 800px; 
            font-weight: 900;
            line-height: 1;
            color: #ffffff;
            opacity: 1;
            
            position: absolute;
            top: 60%;
            left: 50%;
            transform: translate(-50%, -50%);
            
            display: none;
            z-index: 5; 
        }

        /* =========================================
           4. TYPOGRAFIE
           ========================================= */
        
        h1, h2, h3 { margin: 0; padding: 0; text-shadow: none; }

        #start-text {
            font-family: 'NeueHaasBold', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffffff;
            font-size: 60px;
            line-height: 1;
        }

        .headline-top {
            font-family: 'NeueHaasBold', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffffff;
            font-size: 60px;
            line-height: 1;
            margin-bottom: 0px; 
        }

        .subheadline-bold {
            font-family: 'NeueHaasBold', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffffff;
            font-size: 60px;
            line-height: 1;
            margin-top: 10px; 
        }

        .subheadline-medium {
            font-family: 'NeueHaasMedium', sans-serif;
            font-size: 38px; 
            text-transform: lowercase; 
            color: #ffffff;
            opacity: 1;
            
            margin-top: 10px; 
            
            margin-bottom: 30px;
            letter-spacing: 1px;
            font-weight: normal; 
            line-height: 1;
        }
        
        .subheadline-medium::first-letter {
            text-transform: uppercase;
        }

        /* =========================================
           5. LOAD BAR
           ========================================= */
        #bar-frame {
            width: 26%;
            height: 15px;
            border: 1px solid white;
            background: rgba(0,0,0,0.5);
            position: relative;
            
            margin-top: 15px;
        }

        #bar-fill {
            width: 0%;
            height: 100%;
            background-color: #ffffff;
            transition: width 0.1s linear;
        }

    </style>
</head>
<body>

    <div id="game-container">
        <video id="player" muted playsinline></video>
        
        <div id="ui-layer">
            <div id="start-container">
                <h1 id="start-text">STISKNI MEZERNÍK PRO START</h1>
            </div>

            <div id="game-text-wrapper" class="text-anchor-top">
                <h2 class="headline-top">ZMÁČKNI NOUZOVÉ TLAČÍTKO</h2>
                <h1 class="subheadline-bold">PRO ZASTAVENÍ SOUPRAVY!</h1>
            </div>

            <div id="countdown">10</div>
            
            <div id="mash-ui">
                <h2 class="headline-top">TLAČÍTKO JE NEFUNKČNÍ!</h2>
                <h3 class="subheadline-medium">Zkus ho stlačit znovu dokud se to nepovede!</h3>
                <div id="bar-frame"><div id="bar-fill"></div></div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // ⚙️ NASTAVENÍ
        // ==========================================
        const V_01_INTRO    = 'video_01.mp4';
        const V_02_FAIL     = 'video_02.mp4';
        const V_03_CLICK    = 'video_03.mp4';
        const V_04_A_RESCUE = 'video_04_A.mp4';
        const V_04_B_TRAGEDY= 'video_04_B.mp4';

        const CAS_NA_REAKCI = 10000;
        const CAS_NA_MASHING = 10000;
        const MASH_DIFFICULTY = 25;
        const BAR_DECAY = 0.3;

        // ==========================================
        
        const video = document.getElementById('player');
        
        const startContainer = document.getElementById('start-container');
        const gameTextWrapper = document.getElementById('game-text-wrapper');
        const countdownEl = document.getElementById('countdown');
        const mashUI = document.getElementById('mash-ui');
        const barFill = document.getElementById('bar-fill');

        let stav = 'START';
        let timerSmrti;
        let odpocetInterval;
        let barValue = 0;
        let gameLoop;

        function play(src, loop = false) {
            video.src = src;
            video.loop = loop;
            video.currentTime = 0;
            
            let playPromise = video.play();
            
            if (playPromise !== undefined) {
                playPromise.then(_ => { })
                .catch(error => {
                    console.log("CHYBA: Autoplay zablokován:", error);
                });
            }
        }

        function startHry() {
            stav = 'START';
            video.removeAttribute('src'); 
            video.load();
            
            startContainer.style.display = 'flex';     
            gameTextWrapper.style.display = 'none';    
            mashUI.style.display = 'none';             
            countdownEl.style.display = 'none';
        }

        function spustitIntro() {
            stav = 'INTRO';
            startContainer.style.display = 'none';
            play(V_01_INTRO, false);
            video.onended = () => { vyzvaKZastaveni(); };
        }

        function vyzvaKZastaveni() {
            stav = 'WAIT';
            gameTextWrapper.style.display = 'flex';
            
            countdownEl.style.display = 'block';
            let zbyvajiciCas = CAS_NA_REAKCI / 1000;
            countdownEl.innerText = zbyvajiciCas;
            
            if (odpocetInterval) clearInterval(odpocetInterval);
            
            odpocetInterval = setInterval(() => {
                zbyvajiciCas--;
                countdownEl.innerText = zbyvajiciCas;
                if (zbyvajiciCas <= 0) clearInterval(odpocetInterval);
            }, 1000);
            
            timerSmrti = setTimeout(() => { prohra("nestihl"); }, CAS_NA_REAKCI);
        }

        function glitchFaze() {
            stav = 'GLITCH';
            clearTimeout(timerSmrti);
            clearInterval(odpocetInterval);
            
            gameTextWrapper.style.display = 'none'; 
            countdownEl.style.display = 'none';
            
            play(V_02_FAIL, false);
            video.onended = () => { startMashing(); };
        }

        function startMashing() {
            stav = 'MASHING';
            barValue = 0;
            mashUI.style.display = 'flex'; 
            play(V_03_CLICK, false); 
            
            timerSmrti = setTimeout(() => { prohra("mashing_fail"); }, CAS_NA_MASHING);
            
            if (gameLoop) clearInterval(gameLoop);
            gameLoop = setInterval(logicLoop, 50);
        }

        function logicLoop() {
            if (stav !== 'MASHING') return;
            if (barValue > 0) barValue -= BAR_DECAY;
            if (barValue < 0) barValue = 0;
            barFill.style.width = Math.min(barValue, 100) + '%';
        }

        function playerMash() {
            barValue += (100 / MASH_DIFFICULTY); 
            video.currentTime = 0;
            video.play();
            if (barValue >= 100) { vyhra(); }
        }

        function vyhra() {
            stav = 'END';
            clearTimeout(timerSmrti);
            clearInterval(gameLoop);
            mashUI.style.display = 'none'; 
            play(V_04_A_RESCUE, false);
            video.onended = () => { startHry(); };
        }

        function prohra(duvod) {
            if (stav === 'END') return;
            stav = 'END';
            clearTimeout(timerSmrti);
            clearInterval(gameLoop);
            clearInterval(odpocetInterval);
            
            startContainer.style.display = 'none';
            gameTextWrapper.style.display = 'none';
            countdownEl.style.display = 'none';
            mashUI.style.display = 'none';
            
            play(V_04_B_TRAGEDY, false);
            video.onended = () => { startHry(); };
        }

        document.addEventListener('keydown', (e) => {
            console.log("Klávesa:", e.code, "| Stav:", stav);
            if (e.code === 'Space') {
                if (stav === 'START') spustitIntro();
                else if (stav === 'WAIT') glitchFaze();
                else if (stav === 'MASHING') playerMash();
            }
        });

        startHry();

    </script>
</body>
</html>